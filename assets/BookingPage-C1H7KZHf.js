import{d as Y,r as $,c as M,a as D,b as p,e as u,t as f,f as G,o as c,g as W,h as x,n as Z,w as R,u as d,F as C,i as L,j as B,_ as H,k as F,l as A,m as J,p as K,q as P,s as Q}from"./index-q2JnvMp-.js";function ee(t,e){const n=new Date(t),o=new Date(e);o.setHours(0,0,0,0);const s=new Date(n);s.setHours(0,0,0,0);const l=Math.floor((+s-+o)/(1e3*60*60*24));let i="";return l===0?i="сегодня":l===1?i="завтра":i=se(n),{date:t,day:te(n),prefix:i}}function te(t){return t.toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}function se(t){return t.toLocaleDateString("ru-RU",{weekday:"long"})}const V=Y("bookingStore",()=>{const t=$(),e=$(""),n=$([]),o=$([]),s=$([]),l=$(16),i=$(64),v=$(),a=M(()=>s.value.map(m=>ee(m,t.value?.current_day??"2025-04-04")));async function _(){const m="https://hh.frontend.ark.software/api/booking";try{v.value=!0;const h=await(await fetch(m)).json();t.value=h,e.value=t.value.current_day,n.value=[...new Set(t.value.tables.map(g=>g.zone))].sort((g,E)=>{const w=O=>O.includes("этаж");return w(g)&&!w(E)?-1:!w(g)&&w(E)?1:g.localeCompare(E)}),n.value.length>0&&(o.value=[n.value[0]]),s.value=t.value.available_days,e.value=t.value.current_day,v.value=!1}catch(y){console.log(y)}}function r(m){const y=o.value.indexOf(m);y!==-1?o.value.splice(y,1):o.value.push(m)}return{restaurant:t,loadData:_,selectedDate:e,allZones:n,availableDays:s,availableDaysFormat:a,toggleZone:r,isActiveZone:m=>o.value.includes(m),activeZones:o,CELL_WIDTH:l,ROW__HEIGHT:i,isLoader:v}}),ne={class:"booking-btns"},oe={class:"booking-btns__title"},ae={class:"booking-btns__list"},q=D({__name:"BookingButtons",props:{title:{}},setup(t){const e=t;return(n,o)=>(c(),p("div",ne,[u("div",oe,f(e.title),1),u("ul",ae,[G(n.$slots,"default")])]))}}),re={class:"booking-item-btn"},ie={class:"text-semibold"},le=D({__name:"DateButton",props:{selectedDate:{},availableDay:{}},setup(t){const e=t,n=V();function o(s){n.selectedDate=s}return(s,l)=>{const i=W("BaseButton");return c(),p("li",re,[x(i,{class:Z({active:s.availableDay.date===e.selectedDate}),onClick:l[0]||(l[0]=v=>o(s.availableDay.date))},{default:R(()=>[u("span",ie,f(s.availableDay.day),1),u("span",null,f(s.availableDay.prefix),1)]),_:1},8,["class"])])}}}),ce={class:"booking-item-btn"},ue=D({__name:"ZoneButton",props:{zone:{}},setup(t){const e=t,n=V();return(o,s)=>{const l=W("BaseButton");return c(),p("li",ce,[x(l,{class:Z({active:d(n).isActiveZone(e.zone)}),onClick:s[0]||(s[0]=i=>d(n).toggleZone(e.zone))},{default:R(()=>[u("span",null,f(o.zone),1)]),_:1},8,["class"])])}}}),de={class:"section booking-controls"},_e={class:"container"},me=D({__name:"BookingControls",props:{selectedDate:{},availableDays:{},zones:{}},setup(t){const e=t;return(n,o)=>(c(),p("section",de,[u("div",_e,[o[0]||(o[0]=u("h1",null,"Бронирование",-1)),x(q,{title:"Дата",class:"booking-btns__days"},{default:R(()=>[(c(!0),p(C,null,L(e.availableDays,s=>(c(),B(le,{key:s.date,availableDay:s,selectedDate:n.selectedDate},null,8,["availableDay","selectedDate"]))),128))]),_:1}),x(q,{title:"Отображаемые зоны"},{default:R(()=>[(c(!0),p(C,null,L(e.zones,s=>(c(),B(ue,{key:s,zone:s},null,8,["zone"]))),128))]),_:1})])]))}}),pe={class:"table-header booking-table__header",ref:"root"},ve={class:"table-header__top"},fe={class:"table-header__number"},he={class:"table-header__capacity"},ge={class:"table-header__zone"},be=D({__name:"TableHeader",props:{tables:{}},setup(t){const e=t;return(n,o)=>(c(),p("div",pe,[o[0]||(o[0]=u("div",{class:""},null,-1)),(c(!0),p(C,null,L(e.tables,s=>(c(),p("div",{key:s.id,class:"table-header__cell"},[u("div",ve,[u("span",fe,f(s.number),1),u("span",he,f(s.capacity)+" чел",1)]),u("span",ge,f(s.zone),1)]))),128))],512))}}),ye=H(be,[["__scopeId","data-v-3491665a"]]),j=80,Te=32;function N(t){const[e,n]=t.split(":").map(Number);return e*60+n}function I(t){return t.slice(11,16)}function U(t,e,n){const o=I(t.start),s=I(t.end),l=N(e),v=N(n)-l,a=N(o)-l,_=N(s)-l,r=a/v*100,b=(_-a)/v*100,m=j/t.column,h=t.tableIndex*j+Te+m*t.columnIndex+t.offset,g=m-t.offset;return{top:`${r}%`,height:`${b}%`,left:`${h}px`,width:`${g}px`,zIndex:`${10+t.column}`}}function De(t){const e={New:{text:"Новый",selector:"status-new"},Bill:{text:"Пречек",selector:"status-bill"},Closed:{text:"Закрытый",selector:"status-closed"},Banquet:{text:"Банкет",selector:"status-banquet"}};return{currentStatus:M(()=>e[t]||{text:"Ошибка",selector:"status-error"})}}const ke={class:"text-semibold"},$e={key:0},Me={key:1},Se=D({__name:"OrderEvent",props:{event:{},openingTime:{},closingTime:{}},setup(t){const e=t,n=M(()=>e.event.type==="order"),o=M(()=>n.value?e.event.meta:null),{currentStatus:s}=De(o.value?.status);return(l,i)=>(c(),p("div",{class:"event-order",style:F(d(U)(e.event,l.openingTime,l.closingTime))},[u("div",ke,[d(s).text==="Банкет"?(c(),p("span",$e,"Банкет")):(c(),p("span",Me,"Заказ"))]),d(s).text!="Банкет"?(c(),p("div",{key:0,class:Z(["text-semibold event-order__status event__status text-8",d(s).selector])},f(d(s).text),3)):A("",!0),u("div",null,f(d(I)(l.event.start))+"-"+f(d(I)(l.event.end)),1)],4))}}),xe=H(Se,[["__scopeId","data-v-0bae95cc"]]);function Be(t){const e={Новая:{text:"Ожидает подтверждения",selector:"status-new"},Заявка:{text:"Ожидаем",selector:"status-request"},Открыт:{text:"В зале",selector:"status-open"},Отменен:{text:"Отменен",selector:"status-close"},"Живая очередь":{text:"Живая очередь",selector:"status-live"}};return{currentStatus:M(()=>e[t]||{text:"Ошибка",selector:"status-error"})}}const Ee={class:"event-reservation__id text-8"},we={class:"event-reservation__number"},Ce={class:"text-semibold"},Le={class:"text-semibold"},Ie={class:"event-reservation__phone"},Oe=D({__name:"ReservationEvent",props:{event:{},openingTime:{},closingTime:{}},setup(t){const e=t,n=M(()=>e.event.type==="reservation"),o=M(()=>n.value?e.event.meta:null),{currentStatus:s}=Be(o.value?.status);return(l,i)=>{const v=W("BaseIcon");return c(),p("div",{class:"event-reservation",style:F(d(U)(e.event,l.openingTime,l.closingTime))},[u("div",Ee,"№"+f(l.event.id),1),u("div",we,[u("span",Ce,f(o.value?.name_for_reservation)+"; ",1),u("span",Le,f(o.value?.num_people),1),i[0]||(i[0]=u("span",{class:"text-8"},"чел",-1))]),u("div",{class:Z(["text-semibold text-8 event-reservation__status event__status",d(s).selector])},f(d(s).text),3),u("div",Ie,[x(v,{name:"phone",class:"event-reservation__phone_icon"}),J(f(o.value?.phone_number),1)]),u("div",null,f(d(I)(l.event.start))+"-"+f(d(I)(l.event.end)),1)],4)}}}),ze=H(Oe,[["__scopeId","data-v-4b59fc7d"]]),Ne=D({__name:"EventBlock",props:{event:{},openingTime:{},closingTime:{}},setup(t){const e=t,n=M(()=>e.event.type==="order"?xe:e.event.type==="reservation"?ze:null);return(o,s)=>n.value?(c(),B(K(n.value),{key:0,event:e.event,openingTime:e.openingTime,closingTime:e.closingTime,class:"event"},null,8,["event","openingTime","closingTime"])):A("",!0)}}),Re={class:"time-row"},We={class:"time-row__cell"},Ze=D({__name:"TimelineRow",props:{tables:{},time:{}},setup(t){const e=t;return(n,o)=>(c(),p("div",Re,[u("div",We,f(e.time),1),(c(!0),p(C,null,L(e.tables,s=>(c(),p("div",{key:s.id,class:"booking-cell"}))),128))]))}}),He=H(Ze,[["__scopeId","data-v-879d6911"]]);function Fe(t,e,n=30){const o=a=>{const[_,r]=a.split(":").map(Number);return _*60+r},s=a=>{const _=Math.floor(a/60),r=a%60;return`${String(_).padStart(2,"0")}:${String(r).padStart(2,"0")}`},l=o(t),i=o(e),v=$([]);for(let a=l;a<=i;a+=n)v.value.push(s(a));return v.value.pop(),v}function Ae(t){const e=t.match(/T(\d{2}):(\d{2})/);if(e)return{h:Number(e[1]),m:Number(e[2])};const n=new Date(t);return{h:n.getHours(),m:n.getMinutes()}}function S(t){const{h:e,m:n}=Ae(t);return e*60+n}function Ve(t,e,n){return{allEvents:M(()=>{const i={};t.forEach((a,_)=>{n.value.includes(a.zone)&&(a.reservations.forEach(r=>{if(!r.seating_time?.startsWith(e.value))return;const b=S(r.seating_time),m=S(r.end_time);i[_]??=[],i[_].push({original:{id:r.id,type:"reservation",tableIndex:_,start:r.seating_time,end:r.end_time,column:0,columnIndex:0,offset:0,meta:r},startMin:b,endMin:m})}),a.orders.forEach(r=>{if(!r.start_time?.startsWith(e.value))return;const b=S(r.start_time),m=S(r.end_time);i[_]??=[],i[_].push({original:{id:r.id,type:"order",tableIndex:_,start:r.start_time,end:r.end_time,column:0,columnIndex:0,offset:0,meta:r},startMin:b,endMin:m})}))});const v=[];for(const a of Object.keys(i)){const _=Number(a),r=i[_]??[];if(!r.length)continue;r.sort((h,g)=>h.startMin-g.startMin);const b=[];let m=[],y=null;for(const h of r)m.length===0||y!==null&&h.startMin-y<=30?(m.push(h),y=h.startMin):(b.push(m),m=[h],y=h.startMin);m.length&&b.push(m);for(const h of b){h.sort((T,k)=>T.startMin-k.startMin);const g=[],E=[];for(const T of h){let k=-1;for(let z=0;z<g.length;z++)if(g[z]<=T.startMin){k=z;break}k===-1?(g.push(T.endMin),k=g.length-1):g[k]=T.endMin,E.push({item:T,col:k})}const w=Math.max(1,g.length),O=h[0].startMin,X=r.filter(T=>T.startMin<O&&T.endMin>O).length*4;for(const T of E){const k=T.item.original;v.push({...k,tableIndex:_,column:w,columnIndex:T.col,offset:X})}}}return v.sort((a,_)=>{const r=S(a.start),b=S(_.start);return r!==b?r-b:S(a.end)-S(_.end)}),v})}}const Pe={class:"section section-booking"},qe={class:"container"},je={class:"booking-table__body"},Ue=D({__name:"BookingTable",props:{tables:{},selectedDate:{},openingTime:{},closingTime:{},activesZone:{}},setup(t){const e=t,n=Fe(e.openingTime,e.closingTime),{allEvents:o}=Ve(e.tables,P(e,"selectedDate"),P(e,"activesZone"));function s(i,v){const a=i.length,_=v.value.length;return console.log(a,_),{width:`${a*80}px`,height:`${_*80-1e3}px`}}const l=s(e.tables,n);return(i,v)=>(c(),p("section",Pe,[u("div",qe,[u("div",{class:"booking-table",style:F({width:d(l).width})},[u("div",je,[x(ye,{tables:i.tables},null,8,["tables"]),(c(!0),p(C,null,L(d(o),a=>(c(),B(Ne,{key:a.id,event:a,openingTime:i.openingTime,closingTime:i.closingTime},null,8,["event","openingTime","closingTime"]))),128)),(c(!0),p(C,null,L(d(n),a=>(c(),B(He,{key:a,tables:i.tables,time:a},null,8,["tables","time"]))),128))])],4)])]))}}),Xe={key:1},Ke=D({__name:"BookingPage",setup(t){const e=V();return Q(()=>e.loadData()),(n,o)=>{const s=W("BaseLoader");return d(e).isLoader?(c(),B(s,{key:0})):(c(),p("div",Xe,[x(me,{selectedDate:d(e).selectedDate,availableDays:d(e).availableDaysFormat,zones:d(e).allZones},null,8,["selectedDate","availableDays","zones"]),d(e).restaurant?.tables?(c(),B(Ue,{key:0,tables:d(e).restaurant.tables,selectedDate:d(e).selectedDate,openingTime:"11:00",closingTime:"23:00",activesZone:d(e).activeZones},null,8,["tables","selectedDate","activesZone"])):A("",!0)]))}}});export{Ke as default};
